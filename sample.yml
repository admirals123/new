using StackExchange.Redis;
using Azure.Identity;

// ... other code ...

// ... placeholder for hostname and port (same as before) ...

// Configure client options 
ConfigurationOptions options = new ConfigurationOptions
{
    EndPoints = { { hostname, port } },
    Ssl = true,   
    AbortOnConnectFail = false 
};

// Modify the connection setup using OnConfiguring
options.EndPoints.OnConfiguring = (endpoint, configuration) => { 
    var credential = new DefaultAzureCredential();
    string token = credential.GetToken(new Azure.Core.TokenRequestContext(new[] { "https://management.azure.com/" })).Token; 
    configuration.Password = token;
};

// Connect to Azure Redis Cache
ConnectionMultiplexer redis = ConnectionMultiplexer.Connect(options);

// ... rest of your Redis operations ...
